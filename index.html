<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Salt Whisperer</title>
<style>
:root{
 --bgA:#0b1220;--bgB:#14244b;--card:#fff;--text:#0f172a;
 --high:#dc2626;--mod:#f59e0b;--low:#16a34a;--smart:#22c55e;
 --radius:26px;--shadow:0 18px 50px rgba(0,0,0,.35);
}
body{margin:0;font-family:system-ui;background:linear-gradient(135deg,var(--bgA),var(--bgB));color:#e5e7eb;overflow:hidden}
.app{max-width:560px;margin:auto;height:100dvh;display:flex;flex-direction:column;padding:14px;gap:10px}
header{display:flex;justify-content:space-between;align-items:flex-start}
.logo{width:44px;height:44px;border-radius:14px;background:linear-gradient(135deg,#60a5fa,#a78bfa);display:grid;place-items:center;font-weight:900;font-size:20px}
h1{margin:0;font-size:20px}
.sub{font-size:13px;opacity:.85}
.hud{font-size:13px;text-align:right}
.progress{height:12px;background:rgba(255,255,255,.15);border-radius:999px;overflow:hidden}
.progress div{height:100%;width:0%;background:linear-gradient(90deg,#60a5fa,#a78bfa)}
.stack{flex:1;position:relative}

.card{
 position:absolute;inset:0;background:var(--card);color:var(--text);
 border-radius:var(--radius);box-shadow:var(--shadow);
 padding:22px;display:flex;flex-direction:column;justify-content:space-between;
 touch-action:none;
 will-change: transform, opacity;
 transition: transform 180ms ease, opacity 180ms ease;
}
.card.dragging{ transition:none; }

.visual{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;gap:12px}
.emoji{font-size:84px;line-height:1}
.name{font-size:30px;font-weight:900}
.prompt{font-size:16px;color:#475569}
.parts{margin-top:10px;width:100%}
.part{background:#f1f5f9;border-radius:16px;padding:10px 14px;margin-bottom:8px;font-size:15px;text-align:center}
.badges{display:flex;justify-content:space-between}
.badge{font-size:12px;font-weight:900;padding:6px 12px;border-radius:999px}
.smart{background:rgba(34,197,94,.15);color:#065f46}

.controls{display:flex;gap:10px}
button{flex:1;border:0;border-radius:999px;padding:16px;font-weight:900;font-size:15px}
.high{background:rgba(220,38,38,.15);color:#fecaca}
.mod{background:rgba(245,158,11,.15);color:#fde68a}
.low{background:rgba(22,163,74,.15);color:#bbf7d0}

.toast{background:rgba(2,6,23,.7);border-radius:18px;padding:16px;font-size:14px;display:none}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.panel{background:rgba(15,23,42,.95);padding:24px;border-radius:26px;max-width:420px;text-align:center}
.toggleRow{display:flex;gap:6px;flex-wrap:wrap}
.toggle{padding:6px 12px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.3);cursor:pointer}
.toggle.on{background:#22c55e;color:#052e16;border-color:#22c55e}
.footer{font-size:11px;opacity:.75;text-align:center}
</style>
</head>
<body>

<div class="app">
<header>
 <div style="display:flex;gap:10px">
  <div class="logo">üßÇ</div>
  <div>
    <h1>Salt Whisperer</h1>
    <div class="sub">Rookie ‚Üí Whisperer ‚Üí Specialist ‚Üí Master ‚Üí Guru</div>
  </div>
 </div>
 <div class="hud">
  Level <b id="level">1</b>/5<br/>
  <span id="rank">Rookie</span><br/>
  Card <b id="cardN">1</b>/10
 </div>
</header>

<div class="toggleRow">
 <div class="toggle on" data-c="all">All</div>
 <div class="toggle on" data-c="american">American</div>
 <div class="toggle on" data-c="asian">Asian</div>
 <div class="toggle on" data-c="indian">Indian</div>
 <div class="toggle on" data-c="med">Mediterranean</div>
</div>

<div class="progress"><div id="prog"></div></div>
<div class="stack" id="stack"></div>

<div class="controls">
 <button class="high" onclick="answer('high')">‚¨Ö High</button>
 <button class="mod" onclick="answer('mod')">‚¨Ü Moderate</button>
 <button class="low" onclick="answer('low')">Low ‚û°</button>
</div>

<div class="toast" id="toast"></div>
<div class="footer">Educational only ‚Ä¢ Brands & recipes vary</div>
</div>

<div class="modal" id="modal"><div class="panel" id="panel"></div></div>

<script>
const FEEDBACK=3000, PASS=7;
const RANKS=["Rookie","Whisperer","Specialist","Master","Guru"];
let level=1, idx=0, correct=0, busy=false;
let cuisines={all:true,american:true,asian:true,indian:true,med:true};

const FOODS=[
 {id:"eggs",n:"Eggs",e:"üç≥",c:"low",t:"Naturally low sodium."},
 {id:"bread",n:"Bread",e:"üçû",c:"mod",t:"Hidden sodium in dough."},
 {id:"bagel",n:"Bagel",e:"ü•Ø",c:"high",t:"Dense breads carry more salt."},
 {id:"rice",n:"Rice",e:"üçö",c:"low",t:"Plain rice is low sodium."},
 {id:"deli",n:"Deli Meat",e:"ü•™",c:"high",t:"Processed meats are salty."},
 {id:"soup",n:"Soup",e:"ü•´",c:"high",t:"Liquid foods hide salt."},
 {id:"cheese",n:"Cheese",e:"üßÄ",c:"mod",t:"Salt is part of cheese."},
 {id:"chips",n:"Chips",e:"ü•î",c:"high",t:"Engineered for salt."},
 {id:"veg",n:"Vegetables",e:"ü•¶",c:"low",t:"Naturally low sodium."},
 {id:"oat",n:"Oatmeal",e:"ü•£",c:"low",t:"Plain oats are sodium safe."}
];

const MEALS_BASE=[
 {id:"chicken_plate",n:"Grilled Chicken Plate",e:"üçó",c:"low",s:true,cu:"american",p:["Chicken","Rice","Vegetables"],t:"Repeatable low-sodium dinner."},
 {id:"burger_fries",n:"Burger & Fries",e:"üçî",c:"high",cu:"american",p:["Burger","Fries"],t:"Sides drive sodium."},
 {id:"teriyaki",n:"Teriyaki Bowl",e:"üçú",c:"high",cu:"asian",p:["Chicken","Sauce","Rice"],t:"Sauce is the culprit."},
 {id:"stirfry",n:"Stir Fry (Low-sodium)",e:"ü•¶",c:"mod",s:true,cu:"asian",p:["Vegetables","Protein"],t:"Light sauce keeps sodium down."},
 {id:"dal_rice",n:"Dal & Rice",e:"ü•£",c:"low",s:true,cu:"indian",p:["Dal","Rice"],t:"Spices without salt."},
 {id:"butter_chicken",n:"Butter Chicken",e:"üçõ",c:"high",cu:"indian",p:["Sauce","Naan"],t:"Restaurant sauces add salt."},
 {id:"med_bowl",n:"Mediterranean Bowl",e:"ü•ó",c:"mod",s:true,cu:"med",p:["Chicken","Veg","Tzatziki"],t:"Sauce on side helps."},
 {id:"gyro",n:"Gyro Plate",e:"ü•ô",c:"high",cu:"med",p:["Meat","Sauce"],t:"Processed meat adds salt."}
];

const MEALS=[...MEALS_BASE];
let i=0;
while(MEALS.length<42){
 const m=MEALS_BASE[i%MEALS_BASE.length];
 MEALS.push({...m,id:m.id+"_"+i});
 i++;
}

let usedFood=new Set();
let usedMeal=new Set();
let round=[];

const stack=document.getElementById("stack");
const toast=document.getElementById("toast");
const modal=document.getElementById("modal");
const panel=document.getElementById("panel");

function shuffle(a){return [...a].sort(()=>Math.random()-.5);}
function activeMeals(){ return cuisines.all ? MEALS : MEALS.filter(m=>cuisines[m.cu]); }

function buildRound(){
 let foodPool=FOODS.filter(f=>!usedFood.has(f.id));
 if(foodPool.length<7) foodPool=FOODS;
 let mealPool=activeMeals().filter(m=>!usedMeal.has(m.id));
 if(mealPool.length<3) mealPool=activeMeals();

 const foods=shuffle(foodPool).slice(0,7).map(f=>{usedFood.add(f.id); return {type:"food",...f};});
 const smartPool=mealPool.filter(m=>m.s);
 const smart=shuffle(smartPool).slice(0,1);
 const others=shuffle(mealPool.filter(m=>!m.s)).slice(0,2);

 [...smart,...others].forEach(m=>usedMeal.add(m.id));

 return shuffle([...foods,...smart.map(m=>({type:"meal",...m})),...others.map(m=>({type:"meal",...m}))]);
}

function render(){
 stack.innerHTML=""; toast.style.display="none";
 const c=round[idx];
 document.getElementById("level").textContent=level;
 document.getElementById("rank").textContent=RANKS[level-1];
 document.getElementById("cardN").textContent=idx+1;
 document.getElementById("prog").style.width=(idx/10*100)+"%";

 const el=document.createElement("div");
 el.className="card";
 el.innerHTML=`
  <div class="badges">
    <div class="badge">${c.type}</div>
    ${c.s?'<div class="badge smart">SMART</div>':''}
  </div>
  <div class="visual">
    <div class="emoji">${c.e}</div>
    <div class="name">${c.n}</div>
    <div class="prompt">What‚Äôs the sodium level?</div>
  </div>
  ${c.p?'<div class="parts">'+c.p.map(x=>'<div class="part">'+x+'</div>').join("")+'</div>':""}
 `;
 stack.appendChild(el);
 enableSwipe(el);
}

// ---- Smooth swipe engine (rAF) ----
function enableSwipe(card){
 let sx=0, sy=0, dx=0, dy=0, dragging=false;
 let rafId=0, pending=false;

 function applyTransform(){
   pending=false;
   const rot = dx/28; // gentler rotation
   const opacity = Math.max(0.35, 1 - Math.min(1, Math.abs(dx)/520));
   card.style.transform = `translate(${dx}px,${dy}px) rotate(${rot}deg)`;
   card.style.opacity = opacity;
 }

 function schedule(){
   if(pending) return;
   pending=true;
   rafId=requestAnimationFrame(applyTransform);
 }

 card.onpointerdown=e=>{
  if(busy) return;
  dragging=true;
  sx=e.clientX; sy=e.clientY;
  dx=0; dy=0;
  card.classList.add("dragging");
  card.setPointerCapture(e.pointerId);
 };

 card.onpointermove=e=>{
  if(!dragging) return;
  dx=e.clientX-sx; dy=e.clientY-sy;
  schedule();
 };

 card.onpointerup=e=>{
  if(!dragging) return;
  dragging=false;
  card.classList.remove("dragging");

  // Decide action
  const horiz = Math.abs(dx) > Math.abs(dy);
  const doHigh = horiz && dx<-120;
  const doLow  = horiz && dx>120;
  const doMod  = !horiz && dy<-120;

  if(doHigh || doLow || doMod){
    // animate card offscreen smoothly
    const w = Math.max(window.innerWidth, 600);
    const offX = doHigh ? -w : (doLow ? w : dx);
    const offY = doMod ? -Math.max(window.innerHeight, 700) : dy;
    card.style.transform = `translate(${offX}px,${offY}px) rotate(${dx/22}deg)`;
    card.style.opacity = 0;

    // Trigger answer immediately (no waiting for animation)
    if(doHigh) answer("high");
    else if(doLow) answer("low");
    else answer("mod");
  } else {
    // snap back
    dx=0; dy=0;
    card.style.opacity = 1;
    card.style.transform = "translate(0,0) rotate(0deg)";
  }
 };

 // Safety: if pointer is canceled (e.g., browser gesture)
 card.onpointercancel=()=>{
   dragging=false;
   card.classList.remove("dragging");
   dx=0; dy=0;
   card.style.opacity = 1;
   card.style.transform = "translate(0,0) rotate(0deg)";
 };
}

function feedback(ok,c){
 toast.style.display="block";
 toast.innerHTML=`<b>${ok?"‚úÖ Correct":"‚ùå Not quite"}</b><br/>${c.t}<br/><i>${ok?"Nice work ‚Äî keep going.":"You‚Äôll spot this faster next time."}</i>`;
}

function answer(choice){
 if(busy) return;
 busy=true;
 const c=round[idx];
 const ok=choice===c.c;
 if(ok) correct++;

 feedback(ok,c);

 setTimeout(()=>{
   idx++; busy=false;
   if(idx>=10) endLevel();
   else render();
 },FEEDBACK);
}

function endLevel(){
 modal.style.display="flex";
 const passed=correct>=PASS;
 if(level===5){
   panel.innerHTML=`<h2>üéâ Guru Achieved</h2>
   <p>You completed all 5 levels.</p>
   <p>You now recognize smart meals and sodium traps.</p>
   <button onclick="restart()">Play Again</button>`;
 } else {
   panel.innerHTML=`<h2>${passed?"Level Up üéâ":"Try Again üîÅ"}</h2>
   <p>Score: <b>${correct}/10</b></p>
   <p>${passed?"Welcome to "+RANKS[level]+".":"You‚Äôre close ‚Äî repeat to advance."}</p>
   <button onclick="next(${passed})">${passed?"Next Level":"Retry"}</button>`;
 }
}

function next(p){modal.style.display="none"; if(p) level++; start();}
function restart(){modal.style.display="none"; level=1; usedFood.clear(); usedMeal.clear(); start();}
function start(){round=buildRound(); idx=0; correct=0; render();}

document.querySelectorAll(".toggle").forEach(t=>{
 t.onclick=()=>{
  const c=t.dataset.c;
  if(c==="all"){Object.keys(cuisines).forEach(k=>cuisines[k]=true);}
  else cuisines[c]=!cuisines[c];
  t.classList.toggle("on");
 };
});

start();
</script>
</body>
</html>
